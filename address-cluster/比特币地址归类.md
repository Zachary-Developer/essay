# bitcoin地址标签与聚合

---
1N52wHoVR79PMDishab2XmRHsbekCdGquK
## 背景
比特币是一种广为人知的分布式加密货币，虽然每笔交易都是在链上的，数据都是可查的，但是人们还是不知道地址后面那个人或者组织。很庆幸，如果是个人地址的话，还是没有一套行之有效的方法去找出来，但是对于机构来说，这件事就不是那么不可操作了。现在有一些网站已经统计了一些公布出来的地址的统计，例如说 walletexplorer.com 。这个网站统计了四大类，交易最活跃，持币量最大的网站。它们将比特币地址分成了一下几类：

    1. 交易所
    2. 矿池
    3. 服务机构
    4. 赌博网站
    
但是这些网站会经常性的更换地址，如何找到这些地址，或者说挖掘出这些地址，就是本文的主要讨论的问题。



## 技术
对于比特币来说，它的地址数据挖掘，主要是依赖于比特币的交易的一些特性。
### 多输入归并
如果在一笔交易中，出现多个输入的地址，那么多个输入的地址，就属于同一个主体。
在这个地址的交易中，它出现在了输入一侧，和它一起出现的其它地址，可以被认为是属于同一个主体（比如说交易所）。
    
    满足条件
    - 输入地址数不为1

这里面的隐含的数学关系，将在后续的文章中，详细介绍。

举个例子:
![image](https://github.com/zhenli-developer/essay/blob/master/address-cluster/TXd654064effe87232c30de246eb92732d9313c95e7c08078c7e0551ccb388539d.png)
[txid=d654064effe87232c30de246eb92732d9313c95e7c08078c7e0551ccb388539d](https://www.chainup.info/d654064effe87232c30de246eb92732d9313c95e7c08078c7e0551ccb388539d)

## 转账与找零
如果一笔交易中，出现了有且只有2个输出地址的时候，并且这两个地址都不是输入地址时,其中一个地址是接收转账，那另一个就是找零地址。那么这个找零地址的主体，应该和输入方是同一个人。

这个推理的逻辑其实是，比特币的找零机制。在默认的情况下，找零会出现在一个新的地址中。
    
    满足条件
    1. 输出地址数为2
    2. 输入地址数不为2
    3. 输入地址和输出地址不能相同
    4. 其中一个输出地址的btc数，必须是拥有4位以上小数的值
    5. 另一个输出地址，不能再以往的此类地址的集合中
    
举个例子:
![image](https://github.com/zhenli-developer/essay/blob/master/address-cluster/TX1e4968cac36d91c4a4294810e9d384e4b52bb73695dc23feb9459c5d89ab6e9c.png)
[txid=1e4968cac36d91c4a4294810e9d384e4b52bb73695dc23feb9459c5d89ab6e9c](https://www.chainup.info/1e4968cac36d91c4a4294810e9d384e4b52bb73695dc23feb9459c5d89ab6e9c)

### 数学原理
#### 极大似然估计
为了解决这种情况，我们提出了一个概率假设，来代表不同数据源的概率模型。我们将考虑不同类型的观察（我们将其视为独立的，以使其在计算上可解决）：

- 如果某些 $t \in T_H$  的所有地址$AddrH(t)$确实属于同一用户，则概率为$p$。
- 如果同一用户控制的两个地址 ${a_i，a_j} \in L$ ，则概率$p$为正。 换句话说，关于$L$中任何地址对之间的负关联的信息由概率$1-q$验证。
- 假设设概率$P(A,T_H,L | p,q)$是该函数的函数聚类$A$，事务$T_H$和负对$L$:
```
    $$P(A,T_H,L | p,q)=\prod_{t \in T_H} p^{\prod \{Addr_H(t)\subset Cl(A)\}} \times (1-p)^{\prod \{Addr_H(t)\not\subset Cl(A)\}} \times \prod_{\{a，a^\prime \}\in L} q^{\prod \{\{a,a^\prime\}\not\subset Cl(A)\}} \times (1-q)^{\prod \{\{a,a^\prime\}\subset Cl(A)\}}$$
    
    其中$S$为比特币地址的集合。$S \subseteq Cl(A)$表示存在这样一个聚合$A_l$，使得$S \subseteq A_l$。

    下一步，我们对表达式去对数，进而得到

    $$
    lnP(A,T_H,L | p,q)=\sum_{t \in T_H} {\prod \{Addr_H(t)\subset Cl(A)\}}ln(1-p)+\sum_{t \in T_H} {\prod \{Addr_H(t)\not\subset Cl(A)\}}ln(p)+\sum_{\{a，a^\prime \}\in L}{\prod \{\{a,a^\prime\}\not\subset Cl(A)\}}ln(1-q) +\sum_{\{a，a^\prime \}\in L}{\prod \{\{a,a^\prime\}\subset Cl(A)\}}ln(q)
    $$



    $$\Delta t_j(\sum_{\{a，a^\prime \}\in L})=\sum_{\{a，a^\prime \}\in \hat{A}_j}{\prod (\{a,a^\prime\}\subset A_l)}-\sum_{i=1}^{m_j}\sum_{\{a，a^\prime \}\in \hat{A}_j}{\prod (\{a,a^\prime\}\subset A_l)}=\Delta\hat{A}_j-\sum_{i=1}^{m_j}\Delta A_i
    $$

    $$\Delta{P(t_j,A,L | p,q)}=ln(\frac{p}{1-p})+(\Delta\hat{A}_j-\sum_{i=1}^{m_j}\Delta A_i)ln(\frac{q}{1-q}))$$
```
    

在掌握了以上数据之后。我们就要进行下一步的数据挖掘工作了。walletexplorer.com 的地址多数情况下比较老，不过这并不影响我们的第一步挖掘工作。


## 第一步，挖掘
这一步挖掘工作，我们将以源数据为出发点，找到这些地址与我们从 bitinfocharts.com 爬取到地址之间找到一些契合关系。这一步主要使用的技术。以下三种：

### 交易链
我们可以从walletexplorer.com的地址出发，作为tx_input，去寻找一条交易链，使得 bitinfocharts.com 上的地址，或者是我们自己生成的富豪榜里的地址，作为输出。这样就找了一组属于同一机构的地址

### 更换新地址
为了钱包的安全，定期更换钱包地址，是一种很有效的行为。因此我们可以通过捕获这种交易来找出那些地址属于同一个钱包：



## 第二步，筛选

### 交易所地址筛选
在一直交易所的地址进行中进行筛选，除掉一些中间转账的地址。

#### 热钱包
这类钱包地址，一般都能在短时间内拥有上万笔交易，有的甚至到十万笔以上。同时交易所也会定期更换它们的热钱包地址，老的地址的交易数就不会再增加了。因此这类地址很容易就可以被分离出来。因为他们满足几个条件：
- address相关的交易数大于10,000
- 完成这个交易数的高度差小于4320（144\*30）
- 在使用一段时间后，地址数不再增加

 
#### 冷钱包
这类地址和上面基本上就是相反的，它们就如同交易所的存钱罐，交易数量极少，但是address的余额极大（一般都超过10,000），因此它们满足这几个条件：
- address相关的交易数小于200
- address的余额超过10,000
- 使用寿命（高度差）不会大于25,930（144\*30\*6）
- 被包含于更换钱包地址集合中





## 引用
https://bitfury.com/content/downloads/clustering_whitepaper.pdf



